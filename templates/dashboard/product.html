{% extends 'partials/base.html' %}
 {% load crispy_forms_tags %}
{% block title %}Product Page{% endblock %}

{% block content %}
 {% include 'partials/topnav.html' %}
         <!--Table-->

    <div class="container">
          <div class="row my-4">
                <div class="col-md-4">
                  {% for message in messages %}
                  {% if message %}

                  <div class="alert alert-{{message.tags}}">
                    {{message}}
                  </div>

                  {% endif %}
                  {% endfor %}
                  <div class="border bg-white p-3">
                    <h4>Add Products</h4><a href="{% url 'upload_products' %}" class="btn btn-success">Upload Excel</a>

                    <hr>
                    <form method="POST" enctype="multipart/form-data">  <!-- add enctype -->
                          {% csrf_token %}
                          {{ form | crispy }}
                          <input class="btn btn-success btn-block" type="submit" value="Add Products">
                    </form>

                  </div>
                </div>
                <div class="col-md-8">
                  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

<form method="get" action="{% url 'dashboard-product' %}" class="mb-3">
    <input 
        type="text" 
        id="product-search" 
        name="query" 
        class="form-control" 
        placeholder="Search products..." 
        style="max-width:300px; display:inline-block;" 
        value="{{ query|default:'' }}"
    >
</form>
                  <table class="table bg-white">
  <thead class="bg-info">
    <tr class='bg-white'>
      <th scope="col"></th>
      <th scope="col">Image</th>
      <th scope="col">Name</th>
      <th scope="col">Category</th>
      <th scope="col">Quantity</th>
      <th scope="col">Price</th>
      <th scope="col">Activity</th>
    </tr>
  </thead>
  {% comment %} <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script> {% endcomment %}

  <tbody>
    {% for item in items %}
    <tr>
      <th scope="row"></th>
      <td>
        {% if item.image %}
        <img src="{{ item.image.url }}"  alt="{{ item.name }}"width="50" height="50" style="object-fit:cover;">
        {% else %}
        <span>No image</span>
        {% endif %}
      </td>
      <td> <a href="{% url 'product-orders' item.id %}">
        {{ item.name }}
      </a>
      </td>
      <td>{{ item.category }}</td>
      <td>{{ item.quantity }}</td>
      <td>{{ item.price }}</td>
      <td>
        <a class="btn btn-info btn-sm" href="{% url 'dashboard-product-update' item.id %}">Edit</a>
        <a class="btn btn-danger btn-sm" href="{% url 'dashboard-product-delete' item.id %}">Delete</a>
      </td>
    </tr>
    {% endfor %}
   

  </tbody>
</table>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
 <script>
$(function() {
    $("#product-search").autocomplete({
        source: "{% url 'product-autocomplete' %}",  // Django endpoint returning JSON
        minLength: 1,  // start showing suggestions after typing 1 character
        select: function(event, ui) {
            // Redirect to the audit page of the selected product
            window.location.href = "/product/" + ui.item.value + "/audit/";
        }
    });
});
</script>

{% endblock%}